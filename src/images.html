<!DOCTYPE html>
<html>
<head>
  <!-- Compiled and minified CSS -->
  <!--Import Google Icon Font-->
  <link href="//fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Compiled and minified JavaScript -->

</head>
<body>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>

<script src="/assets/camera51.js"></script>


<script src="/assets/dragdropfile/filereader.js"></script>
<script src="/assets/dragdropfile/script.js"></script>
<link href="/assets/dragdropfile/style.css" rel="stylesheet">

<style type="text/css">
  body{
    background-color: whitesmoke;

  }
  .resultImg {
    background-color: white;
    max-height: 200px;max-width: 200px;
  }
  .modal {
    max-height: 100%;
    width: 80%;
  }
</style>

<div id="dropbox">
  <div class="text">
    Drop Images Here
  </div>
</div>
<div id="imageList">
</div>



<!-- Modal Structure -->
<div id="modal1" class="modal">
  <div class="modal-content">
    <h4>Modal Header</h4>
    <div id="imgLoader"></div>
    <button  type="button" class="btn btn-default" onclick="camera51.setColor('colorFG');">Mark Object</button>
    <button  type="button" class="btn btn-default" onclick="camera51.setColor('colorBG');">Mark Background</button>
    <button   type="button" class="btn btn-default" onclick="camera51.undo()">UNDO</button>
    <br>


    <button   type="button" class="waves-effect waves-circle transparent" style="position: absolute;
            top: 127px;" onmousedown="camera51.onclickLongZoomIn()" onmouseup="camera51.onmouseupLongZoomIn()" ><i class="material-icons right">zoom_in</i></button>
    <button  type="button" class="waves-effect waves-circle transparent" style="position: absolute;
            top: 167px;" onmousedown="camera51.onclickLongZoomOut()" onmouseup="camera51.onmouseupLongZoomOut()" ><i class="material-icons right">zoom_out</i></button>

    <br>

    <div id="ad54" style="height:500px;width:100%">
    </div>
  </div>
  <div class="modal-footer">
    <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Close</a>
    <button   type="button" class="btn btn-default" onclick="camera51.showResult()">Show Result</button>
    <button   type="button" class="btn btn-default" onclick="camera51.saveImage()">Save Image</button>
  </div>
  <div class="modal-footer">


  </div>
</div>

<script>
  window.onload = function(){

    initCamera51({
      elementId: "ad54", // Div to insert the iframe.
      apiUrl: "//sandbox.malabi.co", // Production url provided upon request !
      iframeSrc: "//assets-malabi.s3.amazonaws.com/apiexample/index.html", // where are you placing index.html Add domain if necessary
      showWrapperShadow: true, // shadow for around the image
      decreaseInnerHeight: 10, // should the wrapper be a little smaller to show the shadow.
      wrappermarginTop:1,
      backgroundColor: "#0832d", // background color in the edit window
      customerId: customerId, //
      //trackId: "http://s3.amazonaws.com/cam-dev-server/19052016/1231234/SID_ed69efad9948419b90e6a7500c42bda4/5588751fc6d340fc9ed2982f9a77ef80.jpg",
    //  originalImageUrl: "http://s3.amazonaws.com/cam51-img-proc/04062016/32/SID_4f72b938ee5a444ca6fb4371995ba3d8/5b928fc0950d4e51ad2d9d17662055b5.jpg",
      callbackStartLoader: function(){
        // then user return a url

        document.getElementById('imgLoader').style.visibility = "";
      },
      callbackStopLoader: function(){
        document.getElementById('imgLoader').style.visibility = "hidden";
      },
      callbackFuncSave: function(response){
        //document.getElementById('resultUrl').value = response;
        console.log("save " + response);
      },
      callbackError: function(response){
        // response.error = (types:  trackerIdNotFound)
        // response.message
        // document.getElementById('responseError').value = JSON.stringify(response);
      }

    });
  }
  var apiUrl = "http://sandbox.malabi.co/Camera51Server/processImageAsync";
  var sqsUrl = "https://sqs.us-east-1.amazonaws.com/039264183653/DEVexample";
  var customerId = 3;
  var camera51ShowImage = new Camera51ShowImage(); // Object, functions for registering analytics events.
  camera51ShowImage.checkUpdatesSQS();


  function sqsListener(imageId, origImgUrl) {
//    console.log(origImgUrl);
    var settings = {
      //  "async": true,
      //  "crossDomain": true,
      "url": apiUrl,
      "method": "POST",
      "headers": {
        "content-type": "application/x-www-form-urlencoded"
      },
      "data": {
        "origImgUrl": origImgUrl,
        "token": "a059e275-52e0-4524-8050-3872fdd8d9af",
        "customerId": customerId,
        "callbackURL": sqsUrl,
        "trackId" : origImgUrl
      }
    };

    $.ajax(settings).done(function (response) {
      var trackId = response.response["trackId"];
      var element = document.getElementById("resultPreview-" + imageId);

      camera51ShowImage.addSearchArray(element, trackId);
    });
  };

    function malabiShowImageCallback(elem, img, processingResultCode, trackId){

      if(processingResultCode == 0){
        $(elem).html('<img id="theImg" src="'+img +'" style="width: 100%;height: auto;" onclick="runCameraTrackId(\''+trackId+'\');" />');
      }
      if(processingResultCode > 0) {
        $(elem).html('error ' + processingResultCode);
      }

    };


  // IFRAME

  function enableButtons(){
    $( "button" ).removeClass( "disabled" );
  }

  function disableButtons(){
    $( "button" ).addClass( "disabled" );

  }

  function runCameraTrackId(trackId){
    var nObj = {};

    var customerIda = customerId;
    var originalImageUrl = trackId;

    $.extend( nObj, {'customerId': customerIda,
      'trackId': trackId} );
    $('#modal1').openModal();
    console.log(nObj);

    camera51.setDataTrackId(nObj);


  }

</script>
</body>
</html>

